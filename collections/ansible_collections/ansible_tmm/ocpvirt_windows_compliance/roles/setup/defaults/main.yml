---
# Setup Role Defaults
# Configure infrastructure components for compliance management

# Compliance Thresholds (easily overridable in job template)
compliance_threshold_critical: 100  # CAT I must be 100%
compliance_threshold_warning: 95
compliance_threshold_info: 80

# Tenant Configuration
# Override these values for your environment
tenant_config:
  name: "default"
  namespace: "compliance"

  storage:
    backend: "pvc"  # pvc | s3
    pvc_name: "compliance-reports"
    pvc_storage_class: ""  # Use cluster default if empty
    pvc_size: "50Gi"
    # S3 configuration (when backend: s3)
    s3_endpoint: ""
    s3_bucket: ""
    s3_region: "us-east-1"
    # Note: S3 credentials should be stored in AAP credentials, not here

  retention:
    scan_results_days: 90
    reports_days: 365
    audit_logs_days: 730

  scan_schedule:
    frequency: "1h"  # 15m | 30m | 1h | 4h | daily
    stagger_minutes: 5

  alerting:
    thresholds:
      critical: 100  # CAT I must be 100%
      warning: 95
      info: 80
    webhook_url: ""  # Override per-tenant

# Event-Driven Ansible (EDA) Configuration
# EDA is set up first to create event stream, then Alertmanager points to it
eda_enabled: true
eda_project_name: "Windows Compliance"
eda_project_url: ""  # Git URL for rulebook project (override in job template)
eda_decision_environment: "Default Decision Environment"
eda_rulebook_name: "compliance_remediation"
eda_event_stream_name: "compliance-alerts"
# RH AAP Credential for Rulebook Activations
# This credential allows rulebooks to trigger job templates on Automation Controller
# If empty, setup will create one named "<event_stream_name>-aap-credential"
# If you have an existing RH AAP credential, provide its name here
eda_aap_credential_name: ""

# Auto-remediation settings per category
eda_auto_remediate_cat1: false  # CAT I - Critical, requires manual review
eda_auto_remediate_cat2: true   # CAT II - Auto-remediate
eda_auto_remediate_cat3: true   # CAT III - Auto-remediate

# AAP Gateway Connection (required for ansible.eda modules in AAP 2.5+)
# These can be set via environment variables or passed from AAP credential
# Environment variables: AAP_HOSTNAME, AAP_USERNAME, AAP_PASSWORD, AAP_TOKEN
aap_hostname: "{{ lookup('ansible.builtin.env', 'AAP_HOSTNAME', default='') }}"
aap_username: "{{ lookup('ansible.builtin.env', 'AAP_USERNAME', default='') }}"
aap_password: "{{ lookup('ansible.builtin.env', 'AAP_PASSWORD', default='') }}"
aap_token: "{{ lookup('ansible.builtin.env', 'AAP_TOKEN', default='') }}"
aap_validate_certs: true

# EDA Token and Authentication
eda_token: ""  # Bearer token for event stream auth (auto-generated if empty)
eda_token_secret_name: "eda-webhook-token"  # K8s secret name for Alertmanager
eda_organization: "Default"  # EDA organization name
eda_scm_branch: "main"  # Git branch for EDA project
eda_forward_events: true  # Forward events to rulebook activations
eda_headers: "Authorization,Content-Type"  # Headers to include in event payload

# OpenShift Monitoring Configuration
ocpvirt_compliance_enable_user_workload_monitoring: true
ocpvirt_compliance_alertmanager_dedicated: true
# Grafana: Requires Grafana Operator to be installed (not included in OpenShift 4.11+)
ocpvirt_compliance_grafana_dashboards: true

# PrometheusRule Configuration
prometheus_config:
  namespace: "{{ tenant_config.namespace }}"
  rule_name: "compliance-alerts"
  labels:
    app.kubernetes.io/name: "ocpvirt-windows-compliance"
    app.kubernetes.io/component: "monitoring"

# Grafana Dashboard Configuration
grafana_config:
  namespace: "{{ tenant_config.namespace }}"
  dashboard_name: "Windows Compliance"
  datasource: "prometheus"

# =============================================================================
# AAP Job Template Configuration
# =============================================================================
# Enable/disable creation of job templates during setup
aap_create_job_templates: true

# Organization and Project for job templates
aap_job_template_organization: "Default"
aap_job_template_project: "Windows Compliance Collection"

# Credential names (must match existing credentials in AAP)
aap_credential_openshift: "OpenShift Credential"
aap_credential_windows: "Win VM"
aap_credential_s3_reports: ""  # Optional: leave empty if not using S3 for reports

# Inventory for Windows VMs
aap_inventory_windows: "Windows VMs"

# Inventory for localhost-based jobs (report, provision, golden image)
# This inventory should contain only localhost or the AAP controller
aap_inventory_localhost: "Demo Inventory"

# Playbook path prefix (relative to AAP project root)
# If your AAP project points to the git repo root, use:
#   "collections/ansible_collections/ansible_tmm/ocpvirt_windows_compliance/playbooks"
# If your AAP project points directly to the collection, use:
#   "playbooks"
aap_playbook_path_prefix: "collections/ansible_collections/ansible_tmm/ocpvirt_windows_compliance/playbooks"

# Resource labels applied to all created resources
compliance_labels:
  compliance.ocpvirt/managed: "true"
  compliance.ocpvirt/tenant: "{{ tenant_config.name }}"
  compliance.ocpvirt/version: "1.0.0"
