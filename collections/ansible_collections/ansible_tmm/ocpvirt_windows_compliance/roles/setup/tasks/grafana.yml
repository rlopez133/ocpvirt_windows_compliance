---
# Setup Role - Grafana Dashboard Deployment
# Deploys Grafana dashboards for compliance visualization
# Dashboard JSON is stored in files/grafana_dashboards/ to avoid Jinja2 templating issues

- name: Load Grafana dashboard JSON from file
  ansible.builtin.set_fact:
    compliance_dashboard_json: "{{ lookup('ansible.builtin.file', 'grafana_dashboards/compliance-dashboard.json') }}"

- name: Deploy Grafana dashboard ConfigMap
  kubernetes.core.k8s:
    state: present
    definition:
      apiVersion: v1
      kind: ConfigMap
      metadata:
        name: grafana-dashboard-compliance
        namespace: "{{ tenant_config.namespace }}"
        labels:
          grafana_dashboard: "1"
          app.kubernetes.io/name: ocpvirt-windows-compliance
          app.kubernetes.io/component: dashboard
      data:
        compliance-dashboard.json: "{{ compliance_dashboard_json }}"

- name: Display dashboard deployment status
  ansible.builtin.debug:
    msg: "Grafana dashboard ConfigMap deployed to {{ tenant_config.namespace }}"
