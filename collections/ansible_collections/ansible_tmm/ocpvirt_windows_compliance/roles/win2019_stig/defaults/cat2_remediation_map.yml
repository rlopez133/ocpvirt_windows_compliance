---
# Windows Server 2019 STIG CAT II Remediation Map
# Maps V-IDs to remediation actions
# Used by scan-driven remediation to only fix failed controls
#
# Reference: DISA STIG Windows Server 2019 V3R2 (January 2025)
# Source: cyber.trackr.live, stigviewer.com
# Only includes CAT II (Medium Severity) controls that are automatable
#
# Each entry contains:
#   - v_id: The Vulnerability ID from XCCDF results (V-XXXXXX)
#   - stig_id: The STIG rule ID (WN19-XX-XXXXXX)
#   - title: Brief description
#   - automatable: Whether this can be fixed automatically (true/false)
#   - remediation_type: registry, security_policy, audit_policy, user_right, firewall, manual
#   - remediation: The specific fix details

win2019_cat2_remediation_map:
  # ============================================================================
  # Account Lockout Policy Controls
  # ============================================================================
  - v_id: "V-205629"
    stig_id: "WN19-AC-000020"
    title: "Account lockout threshold must be 3 or fewer invalid logon attempts"
    automatable: true
    remediation_type: security_policy
    remediation:
      section: "System Access"
      key: "LockoutBadCount"
      value: 3

  - v_id: "V-205630"
    stig_id: "WN19-AC-000030"
    title: "Reset account lockout counter must be at least 15 minutes"
    automatable: true
    remediation_type: security_policy
    remediation:
      section: "System Access"
      key: "ResetLockoutCount"
      value: 15

  # ============================================================================
  # Password Policy Controls
  # ============================================================================
  - v_id: "V-205656"
    stig_id: "WN19-AC-000060"
    title: "Minimum password age must be at least one day"
    automatable: true
    remediation_type: security_policy
    remediation:
      section: "System Access"
      key: "MinimumPasswordAge"
      value: 1

  - v_id: "V-205658"
    stig_id: "WN19-00-000210"
    title: "Passwords must be configured to expire"
    automatable: true
    remediation_type: security_policy
    remediation:
      section: "System Access"
      key: "MaximumPasswordAge"
      value: 60

  - v_id: "V-205660"
    stig_id: "WN19-AC-000040"
    title: "Password history must be 24 passwords remembered"
    automatable: true
    remediation_type: security_policy
    remediation:
      section: "System Access"
      key: "PasswordHistorySize"
      value: 24

  - v_id: "V-205662"
    stig_id: "WN19-AC-000070"
    title: "Minimum password length must be 14 characters"
    automatable: true
    remediation_type: security_policy
    remediation:
      section: "System Access"
      key: "MinimumPasswordLength"
      value: 14

  # ============================================================================
  # Audit Policy Controls
  # ============================================================================
  - v_id: "V-205627"
    stig_id: "WN19-AU-000120"
    title: "Audit User Account Management must be configured for failures"
    automatable: true
    remediation_type: audit_policy
    remediation:
      subcategory: "User Account Management"
      audit_type: "success,failure"

  - v_id: "V-205673"
    stig_id: "WN19-AU-000030"
    title: "Audit IPsec Driver must include failures"
    automatable: true
    remediation_type: audit_policy
    remediation:
      subcategory: "IPsec Driver"
      audit_type: "success,failure"

  - v_id: "V-205675"
    stig_id: "WN19-AU-000040"
    title: "Audit Security State Change must include success"
    automatable: true
    remediation_type: audit_policy
    remediation:
      subcategory: "Security State Change"
      audit_type: "success"

  - v_id: "V-205676"
    stig_id: "WN19-AU-000050"
    title: "Audit System Integrity must include success and failure"
    automatable: true
    remediation_type: audit_policy
    remediation:
      subcategory: "System Integrity"
      audit_type: "success,failure"

  - v_id: "V-205686"
    stig_id: "WN19-AU-000060"
    title: "Audit Logoff must include success"
    automatable: true
    remediation_type: audit_policy
    remediation:
      subcategory: "Logoff"
      audit_type: "success"

  - v_id: "V-205687"
    stig_id: "WN19-AU-000070"
    title: "Audit Logon must include success and failure"
    automatable: true
    remediation_type: audit_policy
    remediation:
      subcategory: "Logon"
      audit_type: "success,failure"

  - v_id: "V-205688"
    stig_id: "WN19-AU-000080"
    title: "Audit Special Logon must include success"
    automatable: true
    remediation_type: audit_policy
    remediation:
      subcategory: "Special Logon"
      audit_type: "success"

  - v_id: "V-205689"
    stig_id: "WN19-AU-000090"
    title: "Audit Other Object Access Events must include success and failure"
    automatable: true
    remediation_type: audit_policy
    remediation:
      subcategory: "Other Object Access Events"
      audit_type: "success,failure"

  - v_id: "V-205690"
    stig_id: "WN19-AU-000100"
    title: "Audit Removable Storage must include success and failure"
    automatable: true
    remediation_type: audit_policy
    remediation:
      subcategory: "Removable Storage"
      audit_type: "success,failure"

  - v_id: "V-205692"
    stig_id: "WN19-AU-000110"
    title: "Audit Audit Policy Change must include success"
    automatable: true
    remediation_type: audit_policy
    remediation:
      subcategory: "Audit Policy Change"
      audit_type: "success"

  - v_id: "V-205694"
    stig_id: "WN19-AU-000130"
    title: "Audit Authentication Policy Change must include success"
    automatable: true
    remediation_type: audit_policy
    remediation:
      subcategory: "Authentication Policy Change"
      audit_type: "success"

  # ============================================================================
  # Registry Controls - Logging and Auditing
  # ============================================================================
  - v_id: "V-205638"
    stig_id: "WN19-CC-000090"
    title: "Command line data must be included in process creation events"
    automatable: true
    remediation_type: registry
    remediation:
      path: "HKLM:\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\System\\Audit"
      name: "ProcessCreationIncludeCmdLine_Enabled"
      value: 1
      type: dword

  - v_id: "V-205639"
    stig_id: "WN19-CC-000460"
    title: "PowerShell script block logging must be enabled"
    automatable: true
    remediation_type: registry
    remediation:
      path: "HKLM:\\SOFTWARE\\Policies\\Microsoft\\Windows\\PowerShell\\ScriptBlockLogging"
      name: "EnableScriptBlockLogging"
      value: 1
      type: dword

  # ============================================================================
  # Security Policy Controls - Audit Subcategory
  # ============================================================================
  - v_id: "V-205644"
    stig_id: "WN19-SO-000050"
    title: "Audit policy subcategory settings must override audit policy category settings"
    automatable: true
    remediation_type: registry
    remediation:
      path: "HKLM:\\SYSTEM\\CurrentControlSet\\Control\\Lsa"
      name: "SCENoApplyLegacyAuditPolicy"
      value: 1
      type: dword

  # ============================================================================
  # Registry Controls - Security Options
  # ============================================================================
  - v_id: "V-205651"
    stig_id: "WN19-SO-000350"
    title: "Interactive logon must require user to press CTRL+ALT+DEL"
    automatable: true
    remediation_type: registry
    remediation:
      path: "HKLM:\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\System"
      name: "DisableCAD"
      value: 0
      type: dword

  - v_id: "V-205708"
    stig_id: "WN19-SO-000100"
    title: "SMB server must perform SMB packet signing when possible"
    automatable: true
    remediation_type: registry
    remediation:
      path: "HKLM:\\SYSTEM\\CurrentControlSet\\Services\\LanmanServer\\Parameters"
      name: "EnableSecuritySignature"
      value: 1
      type: dword

  - v_id: "V-205712"
    stig_id: "WN19-SO-000110"
    title: "SMB client must perform SMB packet signing when possible"
    automatable: true
    remediation_type: registry
    remediation:
      path: "HKLM:\\SYSTEM\\CurrentControlSet\\Services\\LanmanWorkstation\\Parameters"
      name: "EnableSecuritySignature"
      value: 1
      type: dword

  - v_id: "V-205714"
    stig_id: "WN19-SO-000120"
    title: "WDigest Authentication must be disabled"
    automatable: true
    remediation_type: registry
    remediation:
      path: "HKLM:\\SYSTEM\\CurrentControlSet\\Control\\SecurityProviders\\WDigest"
      name: "UseLogonCredential"
      value: 0
      type: dword

  - v_id: "V-205717"
    stig_id: "WN19-SO-000130"
    title: "LDAP client signing must be required"
    automatable: true
    remediation_type: registry
    remediation:
      path: "HKLM:\\SYSTEM\\CurrentControlSet\\Services\\LDAP"
      name: "LDAPClientIntegrity"
      value: 1
      type: dword

  - v_id: "V-205722"
    stig_id: "WN19-SO-000140"
    title: "Session security for NTLM SSP clients must require NTLMv2 session security"
    automatable: true
    remediation_type: registry
    remediation:
      path: "HKLM:\\SYSTEM\\CurrentControlSet\\Control\\Lsa\\MSV1_0"
      name: "NTLMMinClientSec"
      value: 537395200
      type: dword

  - v_id: "V-205730"
    stig_id: "WN19-SO-000150"
    title: "Session security for NTLM SSP servers must require NTLMv2 session security"
    automatable: true
    remediation_type: registry
    remediation:
      path: "HKLM:\\SYSTEM\\CurrentControlSet\\Control\\Lsa\\MSV1_0"
      name: "NTLMMinServerSec"
      value: 537395200
      type: dword

  - v_id: "V-205733"
    stig_id: "WN19-SO-000160"
    title: "Kerberos encryption types must be configured to prevent DES and RC4"
    automatable: true
    remediation_type: registry
    remediation:
      path: "HKLM:\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\System\\Kerberos\\Parameters"
      name: "SupportedEncryptionTypes"
      value: 2147483640
      type: dword

  # ============================================================================
  # User Rights Controls
  # ============================================================================
  - v_id: "V-205671"
    stig_id: "WN19-MS-000070"
    title: "Access this computer from the network must be limited to appropriate accounts"
    automatable: true
    remediation_type: user_right
    remediation:
      right: "SeNetworkLogonRight"
      accounts:
        - "Administrators"
        - "Authenticated Users"

  - v_id: "V-205672"
    stig_id: "WN19-MS-000080"
    title: "Deny access to this computer from network must include privileged local accounts"
    automatable: false
    remediation_type: manual
    remediation:
      guidance: |
        WARNING: Auto-remediation disabled - this control blocks local admin accounts from WinRM/network access.
        If using local accounts for Ansible, applying this will lock you out.
        Manual fix: secpol.msc -> Local Policies -> User Rights Assignment ->
        'Deny access to this computer from the network' -> Add 'Local account and member of Administrators group'
        Only apply if using domain accounts for Ansible management.

  # ============================================================================
  # Firewall Controls
  # ============================================================================
  - v_id: "V-205747"
    stig_id: "WN19-FW-000010"
    title: "Windows Firewall with Advanced Security must be enabled - Domain Profile"
    automatable: true
    remediation_type: firewall
    remediation:
      profile: "Domain"
      state: enabled

  - v_id: "V-205751"
    stig_id: "WN19-FW-000020"
    title: "Windows Firewall with Advanced Security must be enabled - Private Profile"
    automatable: true
    remediation_type: firewall
    remediation:
      profile: "Private"
      state: enabled

  - v_id: "V-205761"
    stig_id: "WN19-FW-000030"
    title: "Windows Firewall with Advanced Security must be enabled - Public Profile"
    automatable: true
    remediation_type: firewall
    remediation:
      profile: "Public"
      state: enabled

  # ============================================================================
  # Registry Controls - Various Security Settings
  # ============================================================================
  - v_id: "V-205767"
    stig_id: "WN19-CC-000010"
    title: "Windows Defender SmartScreen must be enabled"
    automatable: true
    remediation_type: registry
    remediation:
      path: "HKLM:\\SOFTWARE\\Policies\\Microsoft\\Windows\\System"
      name: "EnableSmartScreen"
      value: 1
      type: dword

  - v_id: "V-205769"
    stig_id: "WN19-CC-000030"
    title: "Early Launch Antimalware driver must be enabled"
    automatable: true
    remediation_type: registry
    remediation:
      path: "HKLM:\\SYSTEM\\CurrentControlSet\\Policies\\EarlyLaunch"
      name: "DriverLoadPolicy"
      value: 3
      type: dword

  - v_id: "V-205770"
    stig_id: "WN19-CC-000040"
    title: "Group Policy objects must reprocess even if they have not changed"
    automatable: true
    remediation_type: registry
    remediation:
      path: "HKLM:\\SOFTWARE\\Policies\\Microsoft\\Windows\\Group Policy\\{35378EAC-683F-11D2-A89A-00C04FBBCFA2}"
      name: "NoGPOListChanges"
      value: 0
      type: dword

  - v_id: "V-205772"
    stig_id: "WN19-CC-000060"
    title: "Downloading print driver packages over HTTP must be prevented"
    automatable: true
    remediation_type: registry
    remediation:
      path: "HKLM:\\SOFTWARE\\Policies\\Microsoft\\Windows NT\\Printers"
      name: "DisableWebPnPDownload"
      value: 1
      type: dword

  - v_id: "V-205774"
    stig_id: "WN19-CC-000080"
    title: "Web publishing and online ordering wizards must be prevented"
    automatable: true
    remediation_type: registry
    remediation:
      path: "HKLM:\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\Explorer"
      name: "NoWebServices"
      value: 1
      type: dword

  - v_id: "V-205775"
    stig_id: "WN19-CC-000100"
    title: "Printing over HTTP must be prevented"
    automatable: true
    remediation_type: registry
    remediation:
      path: "HKLM:\\SOFTWARE\\Policies\\Microsoft\\Windows NT\\Printers"
      name: "DisableHTTPPrinting"
      value: 1
      type: dword

  - v_id: "V-205776"
    stig_id: "WN19-CC-000110"
    title: "Network selection UI must not be displayed on logon screen"
    automatable: true
    remediation_type: registry
    remediation:
      path: "HKLM:\\SOFTWARE\\Policies\\Microsoft\\Windows\\System"
      name: "DontDisplayNetworkSelectionUI"
      value: 1
      type: dword

  - v_id: "V-205777"
    stig_id: "WN19-CC-000120"
    title: "Local users on domain-joined computers must not be enumerated"
    automatable: true
    remediation_type: registry
    remediation:
      path: "HKLM:\\SOFTWARE\\Policies\\Microsoft\\Windows\\System"
      name: "EnumerateLocalUsers"
      value: 0
      type: dword

  - v_id: "V-205778"
    stig_id: "WN19-CC-000130"
    title: "App notifications on lock screen must be turned off"
    automatable: true
    remediation_type: registry
    remediation:
      path: "HKLM:\\SOFTWARE\\Policies\\Microsoft\\Windows\\System"
      name: "DisableLockScreenAppNotifications"
      value: 1
      type: dword

  - v_id: "V-205782"
    stig_id: "WN19-CC-000170"
    title: "Camera access from the lock screen must be disabled"
    automatable: true
    remediation_type: registry
    remediation:
      path: "HKLM:\\SOFTWARE\\Policies\\Microsoft\\Windows\\Personalization"
      name: "NoLockScreenCamera"
      value: 1
      type: dword

  # ============================================================================
  # Manual Controls (Not Automatable)
  # ============================================================================
  - v_id: "V-205631"
    stig_id: "WN19-SO-000130"
    title: "Interactive logon must display legal notice banner text"
    automatable: false
    remediation_type: manual
    remediation:
      guidance: "Configure legal notice banner with organization-specific text"

  - v_id: "V-205633"
    stig_id: "WN19-SO-000120"
    title: "Machine inactivity limit must be set"
    automatable: false
    remediation_type: manual
    remediation:
      guidance: "Set machine inactivity limit - may affect user experience"

  - v_id: "V-205636"
    stig_id: "WN19-CC-000370"
    title: "Remote Desktop Services must require secure RPC communication"
    automatable: false
    remediation_type: manual
    remediation:
      guidance: "May break RDP connectivity - requires careful testing"

  - v_id: "V-205637"
    stig_id: "WN19-CC-000380"
    title: "Remote Desktop Services must set client encryption level to High"
    automatable: false
    remediation_type: manual
    remediation:
      guidance: "May break RDP connectivity - requires careful testing"

  - v_id: "V-205648"
    stig_id: "WN19-PK-000010"
    title: "DoD Root CA certificates must be installed"
    automatable: false
    remediation_type: manual
    remediation:
      guidance: "Requires certificate files from DoD PKI"

  - v_id: "V-205649"
    stig_id: "WN19-PK-000020"
    title: "DoD Interoperability Root CA cross-certificates must be installed"
    automatable: false
    remediation_type: manual
    remediation:
      guidance: "Requires certificate files from DoD PKI"

  - v_id: "V-205650"
    stig_id: "WN19-PK-000030"
    title: "US DoD CCEB Interoperability Root CA cross-certificates must be installed"
    automatable: false
    remediation_type: manual
    remediation:
      guidance: "Requires certificate files from DoD PKI"
